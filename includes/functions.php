<?php      function RedirectTo($new_location) {            header("Location: " . $new_location);            exit;      }      function MysqlPrep($string) {            global $connection;            $escaped_string = mysqli_real_escape_string($connection, $string);            return $escaped_string;      }      function ConfirmQuery($result_set) {            if (!$result_set) {                  die("Database query failed.");            }      }      function FormErrors($errors=array()) {            $output = "";            if (!empty($errors)) {                  $output .= "<div class=\"error\">";                  $output .= "Please fix the following errors:";                  $output .= "<ul>";                  foreach ($errors as $key => $error) {                        $output .= "<li>";                        $output .= htmlentities($error);                        $output .= "</li>";                  }                  $output .= "</ul>";                  $output .= "</div>";            }            return $output;      }      function FindAllRoboticSeasons() {        global $connection;            $query  = "SELECT * ";            $query .= "FROM RoboticSeasons ";            $query .= "ORDER BY RoboticSeasonName ASC";            $RoboticSeasonSet = mysqli_query($connection, $query);            ConfirmQuery($RoboticSeasonSet);            return $RoboticSeasonSet;      }              function FindAllTrainingCourses() {        global $connection;            $query  = "SELECT * ";            $query .= "FROM TrainingCourses ";            $query .= "ORDER BY CourseName ASC";            $TrainingCourseSet = mysqli_query($connection, $query);            ConfirmQuery($TrainingCourseSet);            return $TrainingCourseSet;      }        function FindAllRoleNames() {        global $connection;            $query  = "SELECT * ";            $query .= "FROM RoleNames ";            $query .= "ORDER BY RoleName ASC";            $RoleNameSet = mysqli_query($connection, $query);            ConfirmQuery($RoleNameSet);            return $RoleNameSet;      }        function FindAllMemberTypes() {            global $connection;            $query  = "SELECT * ";            $query .= "FROM MemberTypes ";            $query .= "ORDER BY MemberTypeName ASC";            $MemberTypeSet = mysqli_query($connection, $query);            ConfirmQuery($MemberTypeSet);            return $MemberTypeSet;      }      function FindAllMembers($Limit) {            global $connection;            $query  = "SELECT MemberId, FirstName, LastName ";            $query .= "FROM Members ";            $query .= "ORDER BY LastName, FirstName ASC";        if(strlen($Limit) > 0) {            $query .= $Limit;        }        $MemberSet = mysqli_query($connection, $query);            ConfirmQuery($MemberSet);            return $MemberSet;    }        function CountAllMembers() {        // This function returns the member count        global $connection;            $query  = "SELECT COUNT(MemberId) ";            $query .= "FROM Members";            $CountSet = mysqli_query($connection, $query);            ConfirmQuery($CountSet);        $CountRow = mysqli_fetch_row($CountSet);        $Count = $CountRow[0];    return $Count;            }        function FindMemberTypeById($MemberTypeId) {            global $connection;            $SafeMemberTypeId = mysqli_real_escape_string($connection, $MemberTypeId);            $query  = "SELECT * ";            $query .= "FROM MemberTypes ";            $query .= "WHERE MemberTypeId = {$SafeMemberTypeId} ";            $query .= "LIMIT 1";            $MemberTypeSet = mysqli_query($connection, $query);            ConfirmQuery($MemberTypeSet);            if($MemberType = mysqli_fetch_assoc($MemberTypeSet)) {                  return $MemberType;            } else {                  return null;            }      }      function FindHoursWorkedById($HoursWorkedId) {        // This function finds one hours worked record for one member using the HoursWorkedId field in the HoursWorked table        global $connection;            $SafeHoursWorkedId = mysqli_real_escape_string($connection, $HoursWorkedId);            $query  = "SELECT * ";            $query .= "FROM HoursWorked ";            $query .= "WHERE HoursWorkedId = {$SafeHoursWorkedId} ";            $query .= "LIMIT 1";            $HoursWorkedSet = mysqli_query($connection, $query);            ConfirmQuery($HoursWorkedSet);            if($HoursWorked = mysqli_fetch_assoc($HoursWorkedSet)) {                  return $HoursWorked;            } else {                  return null;            }      }        function FindTrainingTakenById($TrainingTakenId) {        // This function finds one training taken record for one member using the TrainingTakenId field in the TrainingTaken table        global $connection;            $SafeTrainingTakenId = mysqli_real_escape_string($connection, $TrainingTakenId);            $query  = "SELECT * ";            $query .= "FROM TrainingTaken ";            $query .= "WHERE TrainingTakenId = {$SafeTrainingTakenId} ";            $query .= "LIMIT 1";            $TrainingTakenSet = mysqli_query($connection, $query);            ConfirmQuery($TrainingTakenSet);            if($TrainingTaken = mysqli_fetch_assoc($TrainingTakenSet)) {                  return $TrainingTaken;            } else {                  return null;            }      }        function FindMemberRoleById($MemberRoleId) {        // This function finds one member role record for one member using the MemberRoleId field in the MemberRoles table        global $connection;            $SafeMemberRoleId = mysqli_real_escape_string($connection, $MemberRoleId);            $query  = "SELECT * ";            $query .= "FROM MemberRoles ";            $query .= "WHERE MemberRoleId = {$SafeMemberRoleId} ";            $query .= "LIMIT 1";            $MemberRoleSet = mysqli_query($connection, $query);            ConfirmQuery($MemberRoleSet);            if($MemberRole = mysqli_fetch_assoc($MemberRoleSet)) {                  return $MemberRole;            } else {                  return null;            }              }        function FindAllMemberHoursWorkedById($MemberId) {        // This function finds all hours worked for one member using the MemberId field in the HoursWorked table        global $connection;            $SafeMemberId = mysqli_real_escape_string($connection, $MemberId);            $query  = "SELECT * ";            $query .= "FROM HoursWorked ";            $query .= "WHERE MemberId = {$SafeMemberId} ";            $query .= "ORDER BY Date ASC";            $MemberHoursWorkedSet = mysqli_query($connection, $query);            ConfirmQuery($MemberHoursWorkedSet);            return $MemberHoursWorkedSet;        }        function FindAllMemberRolesById($MemberId) {        // This function finds all member roles for one member using the MemberId field in the MemberRoles table        global $connection;            $SafeMemberId = mysqli_real_escape_string($connection, $MemberId);            $query  = "SELECT MemberRoles.MemberRoleId, RoboticSeasons.RoboticSeasonName, RoleNames.RoleName ";            $query .= "FROM MemberRoles INNER Join RoleNames ON MemberRoles.RoleNameId = RoleNames.RoleNameId ";            $query .= "JOIN RoboticSeasons ON MemberRoles.RoboticSeasonId = RoboticSeasons.RoboticSeasonId ";            $query .= "WHERE MemberRoles.MemberId = {$SafeMemberId} ";            $query .= "ORDER BY RoboticSeasons.RoboticSeasonName ASC, RoleNames.RoleName ASC";            $MemberRolesSet = mysqli_query($connection, $query);            ConfirmQuery($MemberRolesSet);            return $MemberRolesSet;        }        function FindAllMemberTrainingById($MemberId) {        // This function finds all member training for one member using the MemberId field in the TrainingTaken table        global $connection;            $SafeMemberId = mysqli_real_escape_string($connection, $MemberId);            $query  = "SELECT TrainingTaken.TrainingTakenId, TrainingTaken.DateTaken, TrainingCourses.CourseName ";            $query .= "FROM TrainingTaken INNER JOIN TrainingCourses ON TrainingTaken.TrainingCourseId = TrainingCourses.TrainingCourseId ";            $query .= "WHERE TrainingTaken.MemberId = {$SafeMemberId} ";            $query .= "ORDER BY TrainingTaken.DateTaken ASC, TrainingCourses.CourseName ASC";            $TrainingTakenSet = mysqli_query($connection, $query);            ConfirmQuery($TrainingTakenSet);            return $TrainingTakenSet;                }        function FindRoboticSeasonById($RoboticSeasonId) {        global $connection;            $SafeRoboticSeasonId = mysqli_real_escape_string($connection, $RoboticSeasonId);            $query  = "SELECT * ";            $query .= "FROM RoboticSeasons ";            $query .= "WHERE RoboticSeasonId = {$SafeRoboticSeasonId} ";            $query .= "LIMIT 1";            $RoboticSeasonSet = mysqli_query($connection, $query);            ConfirmQuery($RoboticSeasonSet);            if($RoboticSeason = mysqli_fetch_assoc($RoboticSeasonSet)) {                  return $RoboticSeason;            } else {                  return null;            }              }        function FindTrainingCourseById($TrainingCourseId) {        global $connection;            $SafeTrainingCourseId = mysqli_real_escape_string($connection, $TrainingCourseId);            $query  = "SELECT * ";            $query .= "FROM TrainingCourses ";            $query .= "WHERE TrainingCourseId = {$SafeTrainingCourseId} ";            $query .= "LIMIT 1";            $TrainingCourseSet = mysqli_query($connection, $query);            ConfirmQuery($TrainingCourseSet);            if($TrainingCourse = mysqli_fetch_assoc($TrainingCourseSet)) {                  return $TrainingCourse;            } else {                  return null;            }      }        function FindRoleNameById($RoleNameId) {        global $connection;            $SafeRoleNameId = mysqli_real_escape_string($connection, $RoleNameId);            $query  = "SELECT * ";            $query .= "FROM RoleNames ";            $query .= "WHERE RoleNameId = {$SafeRoleNameId} ";            $query .= "LIMIT 1";            $RoleNameSet = mysqli_query($connection, $query);            ConfirmQuery($RoleNameSet);            if($RoleName = mysqli_fetch_assoc($RoleNameSet)) {                  return $RoleName;            } else {                  return null;            }      }        function FindMemberById($MemberId) {            global $connection;            $SafeMemberId = mysqli_real_escape_string($connection, $MemberId);            $query  = "SELECT * ";            $query .= "FROM Members ";            $query .= "WHERE MemberId = {$SafeMemberId} ";            $query .= "LIMIT 1";            $MemberSet = mysqli_query($connection, $query);            ConfirmQuery($MemberSet);            if($Member = mysqli_fetch_assoc($MemberSet)) {                  return $Member;            } else {                  return null;            }      }        function FindMemberHoursWorkedById($MemberHoursWorkedId) {        global $connection;            $SafeMemberHoursWorkedId = mysqli_real_escape_string($connection, $MemberHoursWorkedId);            $query  = "SELECT * ";            $query .= "FROM HoursWorked ";            $query .= "WHERE HoursWorkedId = {$SafeMemberHoursWorkedId} ";            $query .= "LIMIT 1";            $MemberHoursWorkedSet = mysqli_query($connection, $query);            ConfirmQuery($MemberHoursWorkedSet);            if($MemberHoursWorked = mysqli_fetch_assoc($MemberHoursWorkedSet)) {                  return $MemberHoursWorked;            } else {                  return null;            }      }        function PasswordEncrypt($password) {              // The 2y means to use the Blowfish encryption              // The 10 is the Cost Parameter which is how many times              // to run the encryption algorythm              $hash_format = "$2y$10$";              // Blowfish requires the salt to be 22 characters or more              $salt_length = 22;              $salt = GenerateSalt($salt_length);              $format_and_salt = $hash_format . $salt;              $hash = crypt($password, $format_and_salt);              return $hash;     }      function GenerateSalt($length) {              // This function generates a random salt              // Not 100% unique, not 100% random, but good enough for a salt              // MD5 returns 32 characters              $unique_random_string = md5(uniqid(mt_rand(), true));              // Valid characters for a salt are [a-zA-Z0-9./]              $base64_string = base64_encode($unique_random_string);              // But not '+' which is valid in base64 encoding              $modified_base64_string = str_replace('+', '.', $base64_string);              // Truncate string to the correct length              $salt = substr($modified_base64_string, 0, $length);              return $salt;      }      function PasswordCheck($password, $existing_hash) {              // existing hash contains format and salt at the start              $hash = crypt($password, $existing_hash);              if($hash == $existing_hash) {                      return true;              } else {                      return false;              }      }      function AttemptLogin($Email, $Password) {              $Member = FindMemberByEmail("$Email");              if($Member) {                      // Found member, now check password                      if(PasswordCheck($Password, $Member["HashedPassword"])) {                              // Password matches                              return $Member;                      } else {                              // Password does not match                              return false;                      }              } else {                      // Member not found                      return false;              }      }      function FindMemberByEmail($memberemail) {            global $connection;            $safe_email = mysqli_real_escape_string($connection, $memberemail);            $query  = "SELECT * ";            $query .= "FROM Members ";            // Add single quotes around {$safe_email} because it is a string variable            $query .= "WHERE Email = '{$safe_email}' ";            $query .= "LIMIT 1";            $Member_set = mysqli_query($connection, $query);            ConfirmQuery($Member_set);            if($Member = mysqli_fetch_assoc($Member_set)) {                  return $Member;            } else {                  return $Member;            }      }      function LoggedIn() {            // Check to see if the admin_id variable is set in the Session            // If it is, then return true            // If not, return false              return isset($_SESSION['MemberId']);      }      function ConfirmLoggedIn() {            // Confirm if the user is authorized to view this page.            if(!LoggedIn()) {                    RedirectTo("login.php");            }      }  ?>